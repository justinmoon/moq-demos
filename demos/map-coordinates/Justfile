#!/usr/bin/env just --justfile

set quiet

# List commands available in this demo.
default:
	just --list

# Install dependencies for the map coordinates demo.
install:
	bun install

# Start the dev server, optionally pointing at a custom relay URL and base path.
demo url='http://localhost:4443/anon' base='/':
    bun install
    APP_BASE='{{base}}' VITE_RELAY_URL='{{url}}' bun run dev

# Build a production bundle targeting the production relay by default.
build url='https://moq.justinmoon.com/anon' base='/':
    bun install
    APP_BASE='{{base}}' VITE_RELAY_URL='{{url}}' bun run build
    @printf "\nBundle ready in dist/. Serve locally with:\n  just serve\n"

# Serve the production bundle for local verification.
serve:
    if ! command -v bunx >/dev/null 2>&1; then \
        echo "bunx not found; install Bun or adjust this target." >&2; \
        exit 1; \
    fi
    bunx --bun serve dist

# Build and deploy to the static hosting target.
static-deploy app='map-coordinates':
    #!/usr/bin/env bash
    set -e
    APP_NAME="{{app}}"
    BASE_PATH="/s/${APP_NAME}/"
    RELAY_URL="https://moq.justinmoon.com/anon"
    
    echo "Building ${APP_NAME} for deployment at ${BASE_PATH}"
    APP_BASE="${BASE_PATH}" VITE_RELAY_URL="${RELAY_URL}" bun run build
    
    if ! command -v deploy-static >/dev/null 2>&1; then
        echo "deploy-static not found in PATH" >&2
        exit 1
    fi
    
    echo "Deploying to justinmoon.com${BASE_PATH}"
    deploy-static "${APP_NAME}" dist
